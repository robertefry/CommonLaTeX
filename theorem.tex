
\usepackage{xparse}
\usepackage[thmmarks]{ntheorem}
\usepackage{chngcntr}

% ------------------------------------------------------------------------------
%   Theorem Environments
% ------------------------------------------------------------------------------

% Define a counter for theorems.
\newcounter{thm}[section]

\makeatletter\newcommand{\bindthmcounter}[1]{
    \ifcsdef{c@chapter}      {\counterwithout{thm}{chapter}      }{}
    \ifcsdef{c@section}      {\counterwithout{thm}{section}      }{}
    \ifcsdef{c@subsection}   {\counterwithout{thm}{subsection}   }{}
    \ifcsdef{c@subsubsection}{\counterwithout{thm}{subsubsection}}{}
    \counterwithin{thm}{#1}
}\makeatother

\pretocmd{\chapter}{\bindthmcounter{chapter}}{}{}
\pretocmd{\section}{\bindthmcounter{section}}{}{}
\pretocmd{\subsection}{\bindthmcounter{subsection}}{}{}
\pretocmd{\subsubsection}{\bindthmcounter{subsubsection}}{}{}

\theoreminframepreskip{0pt}
\theoreminframepostskip{0pt}
\NewDocumentCommand{\qedhere}{O{\proofSymbol}}{\hfill#1}

% ~ Proof Environment ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

{
    \theoremstyle{nonumberplain}
    \theoremheaderfont{\itshape}
    \theorembodyfont{\upshape}
    \theoremseparator{.}
    \theoremsymbol{\ensuremath{\square}}

    \newtheorem{proof}{Proof}
}

% ~ Minor Theorem Environments ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\makeatletter\newtheoremstyle{blockminor}
    {\item[\hskip\labelsep\theorem@headerfont##1\theorem@separator]}
    {\item[\hskip\labelsep\theorem@headerfont##1\ (##3)\theorem@separator]}
\makeatother

{
    \theoremstyle{blockminor}
    \theoremheaderfont{\bfseries\scshape}
    \theorembodyfont{\upshape}
    \theoremseparator{:}
    \theoremsymbol{}

    \newtheorem{claim}{Claim}
    \newtheorem{condition}{Condition}
    \newtheorem{case}{Case}
    \newtheorem{remark}{Remark}
    \newtheorem{thatis}{That is}
    \newtheorem{exempli}{Example}
    \newtheorem{note}{Note}
    \newtheorem{notice}{Notice}
    \newtheorem{hint}{Hint}
}

% ~ Major Theorem Environments ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\NewDocumentCommand{\NewMajorTheorem}{mm}
{
    \newtheorem{#1}[thm]{#2}

    % discourage page breaking during major theorems
    \BeforeBeginEnvironment{#1}{\penalty-500}
    \BeforeBeginEnvironment{#1*}{\penalty-500}
}

\makeatletter\newtheoremstyle{blockmajor}
    {\item[\hskip\labelsep\theorem@headerfont ##1\ ##2\theorem@separator]}
    {\item[\hskip\labelsep\theorem@headerfont ##1\ ##2{\normalfont\ (##3)}\theorem@separator]}
\makeatother

{
    \theoremstyle{blockmajor}
    \theoremheaderfont{\normalfont\bfseries}
    \theorembodyfont{\upshape}
    \theoremseparator{.}
    \theoremsymbol{}

    \NewMajorTheorem{definition}{Definition}
    \NewMajorTheorem{proposition}{Proposition}
    \NewMajorTheorem{postulate}{Postulate}
    \NewMajorTheorem{lemma}{Lemma}
    \NewMajorTheorem{theorem}{Theorem}
    \NewMajorTheorem{corollary}{Corollary}
    \NewMajorTheorem{example}{Example}
}

% ~ Titled Theorem Environments ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\makeatletter\newtheoremstyle{blocktitle}
    {\item[\rlap{\vbox{
        \hbox{\hskip\labelsep\theorem@headerfont ##1\ ##2\theorem@separator}
        \hbox{\strut}\vspace*{0.1\baselineskip}
    }}]}
    {\item[\rlap{\vbox{
        \hbox{\hskip\labelsep\theorem@headerfont ##1\ ##2{\normalfont\ (##3)}\theorem@separator}
        \hbox{\strut}\vspace*{0.1\baselineskip}
    }}]}
\makeatother

{
    \theoremstyle{blocktitle}
    \theoremheaderfont{\normalfont\bfseries}
    \theorembodyfont{\upshape}
}
