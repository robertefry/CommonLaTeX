

\usepackage{xparse}
\usepackage{xifthen}

% ------------------------------------------------------------------------------
%   Mathematics
% ------------------------------------------------------------------------------

\usepackage{amsmath}        % typeset mathematics
\usepackage{mathtools}      % typeset mathematics symbols
\usepackage{derivative}     % typeset derivatives
\usepackage{nicefrac}       % typeset nice fractions

% bind the equation counter to the document structure
\bindcounter{equation}

\usepackage{mleftright}     % typeset math in a more natural way

% use subformula delimiters from the mleftright package
\mleftright

% shorthand to label and tag an equation
\makeatletter\newcommand{\eqn}[1]{
    \if@display\tag{\theequation}\stepcounter{equation}\fi
    \label{#1}
}\makeatother

% use amsmath equation environments
\makeatletter\newcommand{\equationdisplaymath}{
    \renewcommand{\[}{\begin{equation*}}
    \renewcommand{\]}{\end{equation*}}
}\makeatother

% ------------------------------------------------------------------------------
%   Physics
% ------------------------------------------------------------------------------

\usepackage{physics}        % typeset physics
\usepackage{physconst}      % typeset physics constants
% todo: look into using physics2 (and siunitx)

% ------------------------------------------------------------------------------
%   Enclosures
% ------------------------------------------------------------------------------

% Force an enclosure to be of a specific minimum height.
%
% {#1}: The minimum height level desired.
%
\makeatletter\newcommand{\phantomheight}[1]{
    \ifthenelse{\equal{#1}{1}}{\vphantom{\bigl|}}{}
    \ifthenelse{\equal{#1}{2}}{\vphantom{\Bigl|}}{}
    \ifthenelse{\equal{#1}{3}}{\vphantom{\biggl|}}{}
    \ifthenelse{\equal{#1}{4}}{\vphantom{\Biggl|}}{}
    \ifthenelse{\equal{#1}{5}}{\vphantom{\bigggl|}}{}
    \ifthenelse{\equal{#1}{6}}{\vphantom{\Bigggl|}}{}
}\makeatother

\let\ph\phantomheight

% ~ Named Enclosures ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\makeatletter\newcommand{\xenclosures@namemap@get}[1]{
    \csname\csname xenclosures@namemap@data@#1\endcsname\endcsname
}\makeatother

\makeatletter\newcommand{\xenclosures@namemap@set}[2]{
    \expandafter\xdef\csname xenclosures@namemap@data@#1\endcsname{#2}
}\makeatother

% Defines new named enclosure commands for the given list of commands with the
% specified opener and closer symbols.
%
%  {#1}: the command name
%  [#2]: comma-separated list of aliases (optional)
%  {#3}: the opening symbol
%  {#4}: the closing symbol
%
% Any aliases are stored in a global name map for future use in more complex
% enclosures.
%
\makeatletter\NewDocumentCommand{\DeclareNamedEnclosure}{m >{\SplitList{,}}o mm}
{
    \expandafter\DeclareDocumentCommand{#1}{m}
    {
        \left#3 ##1 \right#4
    }
    \newcommand{\AddEnclosureAliasesToNameMap}[1]{
        \xenclosures@namemap@set{##1}{\expandafter\@gobble\string#1}
    }\ProcessList{#2}{\AddEnclosureAliasesToNameMap}
    \let\AddEnclosureAliasesToNameMap\undefined
}
\makeatother

\DeclareNamedEnclosure{\paren}[p,  paren    ]{(      }{)      }
\DeclareNamedEnclosure{\brack}[b,  brack    ]{[      }{]      }
\DeclareNamedEnclosure{\brace}[s,B,brace,set]{\{     }{\}     }
\DeclareNamedEnclosure{\chev }[g,  chev ,gen]{\langle}{\rangle}
\DeclareNamedEnclosure{\abs  }[a,v,abs      ]{\vert  }{\vert  }
\DeclareNamedEnclosure{\norm }[n,V,norm     ]{\Vert  }{\Vert  }
\DeclareNamedEnclosure{\floor}[l,  floor    ]{\lfloor}{\rfloor}
\DeclareNamedEnclosure{\ceil }[u,  ceil     ]{\lceil }{\rceil }
\DeclareNamedEnclosure{\round}[r,  round    ]{\lfloor}{\rceil }

\DeclareNamedEnclosure{\ivoo }[o,open       ]{(}{)}
\DeclareNamedEnclosure{\ivcc }[c,closed     ]{[}{]}
\DeclareNamedEnclosure{\ivoc }[oc,          ]{(}{]}
\DeclareNamedEnclosure{\ivco }[co,          ]{[}{)}

\DeclareNamedEnclosure{\bra  }[bra          ]{\langle}{\vert  }
\DeclareNamedEnclosure{\ket  }[ket          ]{\vert  }{\rangle}

\newcommand{\xp}{\paren}
\newcommand{\xb}{\brack}
\newcommand{\xs}{\brace}
\newcommand{\xg}{\chev }
\newcommand{\xa}{\abs  }
\newcommand{\xn}{\norm }
\newcommand{\xl}{\floor}
\newcommand{\xu}{\ceil }
\newcommand{\xr}{\round}

\newcommand{\io}{\ivoo}
\newcommand{\ic}{\ivcc}

% ~ Functions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\makeatletter\NewDocumentCommand{\xf}{omE{_^}{}}
{
    \IfValueTF{#1}{\xenclosures@namemap@get{#1}{#2}}{#2}
        \IfValueT{#3}{_{#3}}
        \IfValueT{#4}{^{#4}}
    \xf@recurse
}
\NewDocumentCommand{\xf@recurse}{O{p}ge{_^}}
{
    \IfValueT{#2}
    {
        \xenclosures@namemap@get{#1}{#2}
            \IfValueT{#3}{_{#3}}
            \IfValueT{#4}{^{#4}}
        \xf@recurse
    }
}
\makeatother

% ------------------------------------------------------------------------------
%   Miscellaneous
% ------------------------------------------------------------------------------

% vectors
\newcommand{\xv}{\vec}

% matrices
\makeatletter\NewDocumentCommand{\xm}{O{p}m}
{
    \ifthenelse{\equal{#1}{.}}
        { \begin{matrix} #2 \end{matrix} }
        { \xenclosures@namemap@get{#1}{ \xm[.]{#2} } }
}
\makeatother

% ------------------------------------------------------------------------------
%   Operators
% ------------------------------------------------------------------------------

\DeclareMathOperator{\Dom}{Dom}         % domain
\DeclareMathOperator{\CoDom}{CoDom}     % co-domain
\DeclareMathOperator{\Img}{Im}          % image
\DeclareMathOperator{\PreIm}{PreIm}     % pre-image
\DeclareMathOperator{\Ker}{Ker}         % kernel
