
\usepackage{import}
\usepackage{xparse}
\usepackage{etoolbox}
\usepackage{patchcmd}
\usepackage{totcount}

\makeatletter\newcommand{\bindcounter}[1]{
    \expandafter\newcommand\csname bindcounter@#1\endcsname[1]
    {
        \ifcsdef{c@chapter}      {\counterwithout{#1}{chapter}      }{}
        \ifcsdef{c@section}      {\counterwithout{#1}{section}      }{}
        \ifcsdef{c@subsection}   {\counterwithout{#1}{subsection}   }{}
        \counterwithin{#1}{##1}
    }
    \pretocmd{\chapter}      {\csname bindcounter@#1\endcsname{chapter}      }{}{}
    \pretocmd{\section}      {\csname bindcounter@#1\endcsname{section}      }{}{}
    \pretocmd{\subsection}   {\csname bindcounter@#1\endcsname{subsection}   }{}{}
}\makeatother

% ------------------------------------------------------------------------------
%   Look And Feel
% ------------------------------------------------------------------------------

\usepackage[dvipsnames,svgnames,x11names]{xcolor}
\usepackage{xcolor-material}
\usepackage{xcolor-solarized}

% ~ Fonts ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\usepackage[T1]{fontenc}    % typeset encoding (8-bit modern)
\usepackage{slantsc}        % typeset slanted small caps
\usepackage{microtype}      % typeset subliminal refinements

\usepackage{newpxtext}      % use the palatino font for text
\usepackage{newpxmath}      % use the palatino font for math
\usepackage{anyfontsize}    % typeset specific font sizes

\usepackage{fontawesome5}   % use icons

\usepackage[notext,lcgreekalpha,upint]{stix}    % use a complete set of symbols

% ~ Titles ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

% NB: Incompatible with memoir document types.
% \usepackage[explicit,nobottomtitles]{titlesec}  % typeset section titles

% prevent footnotes from breaking across pages
\makeatletter\interfootnotelinepenalty=\@M\makeatother

% configure paragraphs
\setlength{\parskip}{0.8\baselineskip plus 0.2\baselineskip minus 0.3\baselineskip}
\setlength{\parindent}{0pt}

% ~ Footnotes ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\usepackage[stable,multiple,bottom]{footmisc}

% pre-parse to count the total number of footnotes
\regtotcounter{footnote}

% command to add a footnote without referencing it anywhere (use \footref{#1}).
\makeatletter\newcommand{\footreftext}[2]{
    \stepcounter{footnote}
    \footnotetext[\value{footnote}]{\label{#1}#2}
}\makeatother

% ------------------------------------------------------------------------------
%   Content
% ------------------------------------------------------------------------------

\usepackage{multicol}       % typeset multiple columns of equal width
\usepackage{float}          % enable placement options for figures and tables
\usepackage{wrapfig}        % enable text wrapping around figures and tables

\usepackage[justification=centering]{caption}

% retain paragraph separation in multi-columns
\setlength{\multicolsep}{0pt}
\BeforeBeginEnvironment{multicols}{\vskip\parskip}

\usepackage[inline,shortlabels]{enumitem}   % typeset the list environments

% configure spacing for list environments
\setlist[itemize,enumerate,description]{topsep=0pt, partopsep=0pt, parsep=\parskip, itemsep=0pt}

% ~ Bibliography ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\usepackage[style=alphabetic]{biblatex}     % typeset a bibliography
\usepackage{csquotes}       % enable context-sensitive quotation facilities

% add cited references to the cited bibliography category
\DeclareBibliographyCategory{cited}
\AtEveryCitekey{\addtocategory{cited}{\thefield{entrykey}}}

\makeatletter\defbibenvironment{bibliography}
{
    \list{\bfseries\itshape\printfield[labelalphawidth]{labelalpha}}
    {
        \setlength{\leftmargin}{1em}
        \setlength{\labelwidth}{\labelalphawidth}
        \setlength{\labelsep}{\biblabelsep}
        \setlength{\itemindent}{0pt}
        \addtolength{\itemindent}{\labelwidth}
        \addtolength{\itemindent}{\labelsep}
        \addtolength{\itemindent}{-\leftmargin}
        \setlength{\bibitemsep}{\parskip}
        \setlength{\itemsep}{\bibitemsep}
        \setlength{\parsep}{\bibparsep}
    }
    \renewcommand*{\makelabel}[1]{\hss##1\hfill}
}
{\endlist}{\item}\makeatother

% ~ Index and Glossaries ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\usepackage{imakeidx}       % typeset an index
\usepackage{endnotes}       % typeset endnotes
\usepackage[toc,postdot,style=indexgroup]{glossaries-extra} % typeset a glossary

% configure the index
\makeindex[intoc, columns=3, columnseprule=true]

% ~ PDF Hyperlinks ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\usepackage{hyperref}

\hypersetup{
    frenchlinks,
    hidelinks,
    pdfborderstyle={/S/U/W 1},
    allbordercolors=white,
    allcolors=black,
    urlbordercolor=black,
}
\renewcommand{\UrlFont}{\ttfamily\small}

% ------------------------------------------------------------------------------
%   Common Commands and Environments
% ------------------------------------------------------------------------------

\usepackage{pagecolor}          % access the page background color
\usepackage{contour}            % typeset colored contours around text
\usepackage[normalem]{ulem}     % typeset underlined text

\renewcommand{\ULdepth}{1.8pt}
\contourlength{0.8pt}

% nicely underlined text
\newcommand{\ul}[1]{\uline{\phantom{#1}}\llap{\contour{\thepagecolor}{#1}}}
\renewcommand{\underline}{\ul}
