
% ------------------------------------------------------------------------------
%   Package Includes
% ------------------------------------------------------------------------------

% Programming
\usepackage{xparse}
\usepackage{etoolbox}

% Dummy Text
\usepackage[english]{babel}
\usepackage{lipsum}
\usepackage{blindtext}

% Page Formatting
\usepackage[many]{tcolorbox}
\usepackage{vwcol}
\usepackage{multicol}
\usepackage{wrapfig}

% Extra Fonts
\usepackage{bm}
\usepackage{bbold}

% Text Formatting
\usepackage{exercise}
\usepackage[inline,shortlabels]{enumitem}
\usepackage{listings}
\usepackage{siunitx}
\usepackage{xcolor}

% Math Formatting
\usepackage{stackrel}

% Tikz Picture
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{circuitikz}
\usepackage{tkz-euclide}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usetikzlibrary{angles,quotes}
\usetikzlibrary{shapes.geometric,arrows}

% Graph Plotting
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}

% Physics Packages
\usepackage{physics}
\usepackage{physconst}

% Math Packages
\usepackage{mathtools}
\usepackage{amsmath}
% \usepackage{amsthm} (replaced with ntheorem)
\usepackage{amssymb}
\usepackage{amsfonts}


% ------------------------------------------------------------------------------
%   Programming
% ------------------------------------------------------------------------------

% IF Statement
\usepackage{xifthen}
\newcommand{\ifeq}[3]{\ifthenelse{\equal{#1}{#2}}{#3}{  }}
\newcommand{\ifne}[3]{\ifthenelse{\equal{#1}{#2}}{  }{#3}}
\newcommand{\ifel}[4]{\ifthenelse{\equal{#1}{#2}}{#3}{#4}}

% SWITCH Statement
\newcommand{\xcase}[2]{#1 #2} % Dummy, so \renewcommand has something to overwrite...
\NewDocumentEnvironment{switch}{m}{\renewcommand{\xcase}{\ifeq{#1}}}{}


% ------------------------------------------------------------------------------
%   Page Formatting
% ------------------------------------------------------------------------------

% Break Commands
\newcommand{\xbreakpage}{\mbox{}\newpage}
\newcommand{\xbreakparg}{\mbox{}\par}
\newcommand{\xbreakline}{\mbox{}\newline}

% Force GoodBreak Between Sections (redundant?)
\usepackage{titlesec}
\newcommand{\sectionbreak}{\goodbreak}
\newcommand{\subsectionbreak}{\goodbreak}
\newcommand{\subsubsectionbreak}{\goodbreak}


% ------------------------------------------------------------------------------
%   Text Commands & Environments
% ------------------------------------------------------------------------------

% Underlined Text
\usepackage{ulem}
\DeclareDocumentCommand{\underline}{m}{\uline{#1}}
\NewDocumentCommand{\ul}{m}{\underline{#1}}

% Repeat a String N Times
\makeatletter%
\newcount\x@repeat@count%
\newcommand{\xrepeat}[2]{%%
  \begingroup%
  \x@repeat@count=\z@%
  \@whilenum\x@repeat@count<#1\do{#2\advance\x@repeat@count\@ne}%%
  \endgroup%
}%
\makeatother%


% ------------------------------------------------------------------------------
%   Block Environment
% ------------------------------------------------------------------------------

\NewDocumentEnvironment{block}{D<>{0em}O{m}o}%
{%
    \begin{center}%
    %
    \ifeq{#2}{m}%
    {%
        \begin{tcolorbox}[breakable,enhanced,width=\linewidth-#1,blanker]%
        \IfValueT{#3}{\textsl{\uline{#3:}\ }}%
    }%
    \ifeq{#2}{M}%
    {%
        \begin{tcolorbox}[breakable,enhanced,width=\linewidth-#1,sharp corners,boxrule=1pt]%
        \IfValueT{#3}{\textsl{\uline{#3:}\ }}%
    }%
    \ifeq{#2}{t}%
    {%
        \begin{tcolorbox}[breakable,enhanced,width=\linewidth-#1,blanker]%
        \IfValueT{#3}{\textbf{#3}\xbreakline}%
    }%
    \ifeq{#2}{T}%
    {%
        \begin{tcolorbox}[breakable,enhanced,width=\linewidth-#1,sharp corners,boxrule=1pt]%
        \IfValueT{#3}{\textbf{#3}\xbreakline}%
    }%
    \ifeq{#2}{s}%
    {%
        \IfValueTF{#3}%
            {\begin{tcolorbox}[breakable,enhanced,width=\linewidth-#1,sharp corners,boxrule=1pt,title=\textbf{#3}]}%
            {\begin{tcolorbox}[breakable,enhanced,width=\linewidth-#1,sharp corners,boxrule=1pt]}%
    }%
}{%
    \end{tcolorbox}%
    \end{center}%
}%

% Block Lists
\NewDocumentEnvironment{*itemize}{}{\begin{itemize}}{\end{itemize}}
\NewDocumentEnvironment{*itemize*}{}{\begin{block}<3em>\begin{itemize*}}{\end{itemize*}\end{block}}
\NewDocumentEnvironment{*enumerate}{}{\begin{enumerate}}{\end{enumerate}}
\NewDocumentEnvironment{*enumerate*}{}{\begin{block}<3em>\begin{enumerate*}}{\end{enumerate*}\end{block}}


% ------------------------------------------------------------------------------
%   Theorem Environments
% ------------------------------------------------------------------------------

\usepackage[thmmarks]{ntheorem}
\theoreminframepreskip{0pt}
\theoreminframepostskip{0pt}

\NewDocumentCommand{\MakeNewTheorem}{mmo}%
{%
    \IfValueTF{#3}
    {%
        \newtheorem{#1}{#2}[#3]%
    }{%
        \newtheorem{#1}{#2}%
    }%
    \NewDocumentEnvironment{*#1}{}{\begin{block}[M]\begin{#1}}{\end{#1}\end{block}}
}%

% ~ Proof Environment ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\theoremstyle{nonumberplain}
\theoremheaderfont{\itshape}
\theorembodyfont{\upshape}
\theoremseparator{.}
\theoremsymbol{\ensuremath{\square}}

\theoremindent1em
\MakeNewTheorem{proof}{Proof}

\theoremindent0em
\MakeNewTheorem{Proof}{Proof}

% ~ Minor Block Environments ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\makeatletter\newtheoremstyle{blockminor}%
    {\item[\theorem@headerfont\hskip \labelsep \uline{##1}\theorem@separator]}%
    {\item[\theorem@headerfont\hskip \labelsep \uline{##1\ (##3)}\theorem@separator]}%
\makeatother%

\theoremstyle{blockminor}
\theoremheaderfont{\itshape}
\theorembodyfont{\upshape}
\theoremseparator{;}
\theoremsymbol{}

\MakeNewTheorem{claim}{Claim}
\MakeNewTheorem{condition}{Condition}
\MakeNewTheorem{case}{Case}
\MakeNewTheorem{remark}{Remark}
\MakeNewTheorem{thatis}{That is}
\MakeNewTheorem{example}{Example}
\MakeNewTheorem{note}{Note}
\MakeNewTheorem{notice}{Notice}
\MakeNewTheorem{hint}{Hint}
\MakeNewTheorem{todo}{TODO}

% ~ Major Block Environments ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\NewDocumentCommand{\MakeMajorTheorem}{mmo}%
{%
    \MakeNewTheorem{#1}{#2}[#3]%
    \BeforeBeginEnvironment{#1}{\penalty-500}%
    \BeforeBeginEnvironment{#1*}{\penalty-500}%
}%

\makeatletter\newtheoremstyle{blockmajor}%
    {\item[\rlap{\vbox{\hbox{\hskip\labelsep \theorem@headerfont
    ##1\ ##2\theorem@separator}\hbox{\strut}}}]}%
    {\item[\rlap{\vbox{\hbox{\hskip\labelsep \theorem@headerfont
    ##1\ ##2\ \textnormal{(##3)}\theorem@separator}\hbox{\strut}}}]}%
\makeatother%

\theoremstyle{blockmajor}
\theoremheaderfont{\normalfont\bfseries}
\theorembodyfont{\slshape}
\theoremseparator{.}
\theoremsymbol{}

\ProvideDocumentCommand{\majorcounter}{}{section} % renew this command to change major-theorem counters

\MakeMajorTheorem{Definition}{Definition}[\majorcounter]
\MakeMajorTheorem{Postulate}{Postulate}[\majorcounter]
\MakeMajorTheorem{Lemma}{Lemma}[\majorcounter]
\MakeMajorTheorem{Theorem}{Theorem}[\majorcounter]
\MakeMajorTheorem{Corollary}{Corollary}[\majorcounter]
\MakeMajorTheorem{Example}{Example}[\majorcounter]


% ------------------------------------------------------------------------------
%   Math Commands
% ------------------------------------------------------------------------------

% Vector Commands
\usepackage[g]{esvect}
\NewDocumentCommand{\xv}{m}{ \vv{#1} }

% Matrix Commands
\NewDocumentCommand{\xm}{O{p}m}{ \begin{#1matrix} #2 \end{#1matrix} }

% ~ Math Enclosures ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

% Math Enclosures
\NewDocumentCommand{\xenclose}{D<>{0}mmm}%
{%
    \begin{switch}{#1}%
        \xcase{0}{ \left#2 #4 \right#3 }%
        \xcase{1}{ \bigl#2 #4 \bigr#3 }%
        \xcase{2}{ \Bigl#2 #4 \Bigr#3 }%
        \xcase{3}{ \biggl#2 #4 \biggr#3 }%
        \xcase{4}{ \Biggl#2 #4 \Biggr#3 }%
        \xcase{-1}{ #2 #4 #3 }%
    \end{switch}%
}%

% Math Enclosure Groups
\NewDocumentCommand{\xgroup}{D<>{0}O{.}m}%
{%
    \begin{switch}{#2}%
        \xcase{.}{ \xenclose<#1>{.}{.}{#3} }             % default
        \xcase{p}{ \xenclose<#1>{(}{)}{#3} }             % parenthesis
        \xcase{b}{ \xenclose<#1>{[}{]}{#3} }             % brackets
        \xcase{B}{ \xenclose<#1>{\{}{\}}{#3} }           % braces
        \xcase{c}{ \xenclose<#1>{\langle}{\rangle}{#3} } % chevrons
        \xcase{v}{ \xenclose<#1>{\vert}{\vert}{#3} }     % absolute
        \xcase{V}{ \xenclose<#1>{\Vert}{\Vert}{#3} }     % normal
        \xcase{f}{ \xenclose<#1>{\lfloor}{\rfloor}{#3} } % floor
        \xcase{F}{ \xenclose<#1>{\lceil}{\rceil}{#3} }   % ceil
        \xcase{r}{ \xenclose<#1>{\lfloor}{\rceil}{#3} }  % round
    \end{switch}%
}%

% Named Enclosure Groups
\NewDocumentCommand{\xparen}{D<>{0}m}{ \xgroup<#1>[p]{#2} }
\NewDocumentCommand{\xbrack}{D<>{0}m}{ \xgroup<#1>[b]{#2} }
\NewDocumentCommand{\xbrace}{D<>{0}m}{ \xgroup<#1>[B]{#2} }
\NewDocumentCommand{\xchevn}{D<>{0}m}{ \xgroup<#1>[c]{#2} }
\NewDocumentCommand{\xabs}  {D<>{0}m}{ \xgroup<#1>[v]{#2} }
\NewDocumentCommand{\xnorm} {D<>{0}m}{ \xgroup<#1>[V]{#2} }
\NewDocumentCommand{\xfloor}{D<>{0}m}{ \xgroup<#1>[f]{#2} }
\NewDocumentCommand{\xceil} {D<>{0}m}{ \xgroup<#1>[F]{#2} }
\NewDocumentCommand{\xround}{D<>{0}m}{ \xgroup<#1>[r]{#2} }

% Math Function Enclosures
\NewDocumentCommand{\xfunc}{D<>{0}O{f}mm}%
{%
    \begin{switch}{#2}%
        \xcase{f}{ #3\xparen<#1>{#4} }      % function%
        \xcase{t}{ #3\xbrace<#1>{#4} }      % transform%
        \xcase{a}{ #3\xbrack<#1>{\,#4\,} }  % adjoin%
    \end{switch}%
}%
\NewDocumentCommand{\xtrans} {D<>{0}mm}{ \xfunc<#1>[t]{#2}{#3} }%
\NewDocumentCommand{\xadjoin}{D<>{0}mm}{ \xfunc<#1>[a]{#2}{#3} }%


% ------------------------------------------------------------------------------
%   Tikz Styles
% ------------------------------------------------------------------------------

\NewDocumentEnvironment{ctikzpicture}{}{\begin{center}\begin{tikzpicture}}{\end{tikzpicture}\end{center}}
\NewDocumentEnvironment{ctikzcd}{}{\begin{center}\begin{tikzcd}}{\end{tikzcd}\end{center}}

\tikzstyle{flow_startstop} = [rectangle,rounded corners,
minimum width=3cm,minimum height=1cm,text centered,draw=black]
\tikzstyle{flow_inout} = [trapezium,trapezium left angle=70,trapezium right angle=110,
minimum width=3cm,minimum height=1cm,text centered,draw=black]
\tikzstyle{flow_process} = [rectangle,
minimum width=3cm,minimum height=1cm,text centered,draw=black]
\tikzstyle{flow_decision} = [diamond,
minimum width=3cm,minimum height=1cm,text centered,draw=black]

\tikzstyle{arrow} = [thick,->,>=stealth]
\tikzstyle{process} = [rectangle,minimum width=3cm,minimum height=1cm,text centered,draw=black]

\tikzset%
{%
    ,baseline={([yshift=-0.5ex]current bounding box.center)}%
}%


% ------------------------------------------------------------------------------
%   Source Code
% ------------------------------------------------------------------------------

\usepackage{sourcecodepro}
\definecolor{color_keyword}{rgb}{0.500,0.000,0.125}
\definecolor{color_comment}{rgb}{0.500,0.500,0.500}
\definecolor{color_strings}{rgb}{0.000,0.500,0.250}

\lstdefinelanguage{PlainText}{%
}%
\lstset{%
    basicstyle=\scriptsize{}\ttfamily{},%
    keywordstyle=\color{color_keyword},%
    commentstyle=\color{color_comment},%
    stringstyle=\color{color_strings},%
    numbers=left,%
    numberstyle=\tiny{},%
    tabsize=4,%
    breakatwhitespace=false,%
    breaklines=true,%
    showtabs=false,%
    tabsize=4,%
}%
